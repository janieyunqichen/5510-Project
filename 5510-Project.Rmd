---
title: "5510-Projecxt"
author: "T13_Wed_kable"
date: "5/17/2021"
output: html_document
editor_options: 
  chunk_output_type: inline
---

```{r , echo = FALSE, message = FALSE, warning = FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE)

                    
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(ggpubr)
library(plotly)
library(data.table)
library(scales)
library(stringr)      
library(formattable)
library(tidyr)
```

## 1. What is the most frequent fire incident in Victoria (July 2015 to June 2016)? 

```{r,include = FALSE}
#excel_sheets("data/CFA-Incident-Responses.xlsx")

# read the data
library(readxl)
incident<- read_csv("data/incident.csv")
```


```{r}
# count number of incident
q1table <- incident %>% 
  count(code_description) %>% 
  arrange(desc(n)) %>% 
  head(10)  

knitr::kable(q1table, caption = "The Top 10 Fire Incidents in Victoria during 2015-2016",
      col.names = c("Case Name", "Count")) %>% 
  kable_styling(c("hover", 
                  "condensed",
                  position = "center", 
                  fixed_thead = TRUE))
```


From the table above, during 2015-2016, the top 3 most frequently happened fire incidents are not directly caused by human beings. 

The top one is the **`r q1table$code_description[1]`** contains bushfire, wildfire, or rural fire. They are defined as the unplanned, unwanted, uncontrolled fire in an area of combustible vegetation starting in rural areas and urban areas.

The second place is the **`r q1table$code_description[2]`**. The smoke released by any type of fire is a mixture of particles and chemicals produced by the incomplete burning of carbon-containing materials. All smoke contains carbon monoxide, carbon dioxide and particulate matter (PM or soot). 

The third is **`r q1table$code_description[3]`**.  
Based on the data supplied from New South Wales, organic products, including green waste, timber waste, and compost, are more likely to combust. Also, there is a large degree of uncertainty about the products that are involved in recorded fires.


## 4. What is the volunteer structure in 2016?

```{r , include = FALSE}
all_vol <- read_csv("data/volunteer_district.csv")
state_vol <- all_vol %>% 
  filter(district == "Statewide")
  
district_vol <- all_vol %>% 
  filter(district != "Statewide")

#tidy
state_vol <- state_vol %>% 
rename("0-1 years" = `Less than 1`)

district_vol <- district_vol %>% 
rename("0-1 years" = `Less than 1`)
```


```{r ,include = FALSE}
age_tidy_state <- state_vol %>% 
  pivot_longer(cols = c(`0-1 years`, `1-5 years`, `6-10 years`, `11-15 years`, `16-20 years`, `21-25 years`, `26-30 years`, `31-35 years`,`36-40 years`,`41-45 years`,`46-50 years`,`51-55 years`,`56-60 years`,`61-65 years`,`66-70 years`,`71-75 years`,`76-80 years`,`81-85 years`,`86 plus`),
               names_to = "serve_years",
               values_to = "count") %>% 
 # filter(str_detect(serve_years, "years")) %>% 
 # mutate(Serve_years = str_remove_all(serve_years, " years")) %>% 
  select(-c(`Not Found`))
  

age_tidy_state[is.na(age_tidy_state)] <- 0
```

#### 1. Statewide Age Distribution
```{r ,include = FALSE}
#prepare the data
age_state <- age_tidy_state %>% 
  group_by(age) %>% 
  summarise(tot_number = sum(count))%>% 
  mutate(percentage = tot_number/sum(tot_number)) %>% 
  arrange(age)
age_state$percentage <- percent(age_state$percentage)
```


```{r}
#table for age distribution of the statewide volunteers
knitr::kable(age_state, caption = "Age Distribution of the Statewide Volunteers",
        col.names = c("Age", "Count", "Percentage")) %>% 
  kable_styling(c("hover", 
                  "condensed",
                  position = "center", 
                  fixed_thead = TRUE))
```


```{r}
#the plot of age distribution of the statewide volunteers
ggplot(age_state, aes(x = age, y = tot_number)) +
  geom_col()+
  labs(x = "Age", y = "Count", caption = "Age Distribution of the Statewide Volunteers") +
  theme_classic()
```

From the above table and figure, among the whole Victoria state, half of the volunteers' age is greater than 45. There are more volunteers with the age increasing. The largest group of volunteers is aging older than 65. 

#### 2. Statewide Serve Year Situation 

```{r}

serve_state <- age_tidy_state %>% 
  group_by(serve_years) %>% 
  summarise(tot_number = sum(count)) %>% 
  mutate(percentage = tot_number/sum(tot_number)) %>% 
  arrange(desc(percentage))

library(formattable)
serve_state$percentage <- percent(serve_state$percentage)
```


```{r}
#the table of serve year of the statewide volunteers
knitr::kable(serve_state, caption = "Total Serve Year of the Statewide Volunteers",
        col.names = c("Serve Year","Count", "Percentage")) %>% 
  kable_styling(c("hover", 
                  "condensed",
                  position = "center", 
                  fixed_thead = TRUE))
```


```{r, fig.width=13, fig.align="center"}
#the plot of serve year of the statewide volunteers
ggplot(serve_state, aes(x = reorder(serve_years, -tot_number), y = tot_number)) +
  geom_col()+
  labs(x = "Serve Yers", y = "Count", caption = "Serve Year Situation of the Statewide Volunteers") +
  theme_classic()
```

From the above table and the figure, 20% of the people have served as CFA volunteers for 1-5 years. Generally, the number of people is decreasing with the serving years is increasing. Notably, only 5% of people served less than one year, and six people served for 76-80 years.

#### 3.Volunteer Number and Position Structure by District

```{r , include=FALSE}
tidy_district <- district_vol %>% 
  pivot_longer(cols = c(`0-1 years`, `1-5 years`, `6-10 years`, `11-15 years`, `16-20 years`, `21-25 years`, `26-30 years`, `31-35 years`,`36-40 years`,`41-45 years`,`46-50 years`,`51-55 years`,`56-60 years`,`61-65 years`,`66-70 years`,`71-75 years`,`76-80 years`,`81-85 years`,`86 plus`),
               names_to = "serve_years",
               values_to = "count") %>% 
  #filter(str_detect(serve_years, "years")) %>% 
 # mutate(Serve_years = str_remove_all(serve_years, " years")) %>% 
  select(-c(`Not Found`))
  
tidy_district[is.na(tidy_district)] <- 0

q4p2 <- tidy_district %>% 
  group_by(position, district) %>% 
  summarise(count = sum(count)) 
q4p2 <- q4p2 %>% 
  group_by(district) %>% 
  mutate(dis_sum = sum(count),
         percentage = count/dis_sum)
q4p2$percentage <- percent(q4p2$percentage)

q4t1 <- tidy_district %>% 
  group_by(district) %>% 
  summarise(count = sum(count)) %>% 
  arrange(desc(count))

```

```{r}
knitr::kable(q4t1, caption = "Total Number of the Volunteers by District",
        col.names = c("District","Count")) %>% 
  kable_styling(c("hover", 
                  "condensed",
                  position = "center", 
                  fixed_thead = TRUE))
```
From the table above, **`r q4t1$district[1]`**, **`r q4t1$district[2]`**, and **`r q4t1$district[3]`** have the most volunteer numbers. The difference between the highest and the lowest is significant, which is almost six times.


```{r, fig.width=12, fig.align="center"}
library(plotly)
q4p <- ggplot(q4p2, aes(x = district, y = percentage, fill = position))+
  geom_col(position = "stack")+
  scale_fill_brewer(palette = "Dark2")
ggplotly(q4p)
```
The CFA volunteer is consists of operational and non-operational positions. 

The operational volunteers, as known as the firefighters, respond to fire, road accidents, and other incidents where risks are posed to life or property. The role also involves the management of vegetation, fire equipment, or assisting other emergency agencies. Many operational volunteers also undertake non-operational roles.

The non-operational volunteer is the support role. They do not fight fires directly yet provide vital support to brigades. The role involves education across local communities, media and promotion, brigade health and safety management, and so on.

The figure above shows that the percentage of operational and non-operational volunteers among all the districts is close, with roughly 35% for non-operational and 65% for operational.

# Conclusion:
In 2016, most volunteers were over 65 years old, and the majority had served for 1-5 years. Hume district had the most CFA volunteers. The percentage of operational and non-operational are about 35% and 65%.



# Reference:

Cambridge Advanced Learner's Dictionary (Third ed.). Cambridge University Press. 2008. ISBN 978-0-521-85804-5. Archived from the original on 13 August 2009.

Department of Health. (n.d.). Retrieved from https://www.health.ny.gov/environmental/outdoors/air/smoke_from_fire.htm#:~:text=All.

Fattal, A., Kelly, S., Liu, A., Giurco, D. 2016., Waste Fires in Australia: Cause for
Concern? Prepared for the Department of Environment, Canberra by the UTS Institute for
Sustainable Futures, Sydney.

Volunteer with CFA. (2021, April 30). Retrieved from https://www.cfa.vic.gov.au/volunteer-careers/volunteers.
