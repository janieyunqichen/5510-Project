---
title: "5510-Projecxt"
author: "T13_Wed_kable"
date: "5/17/2021"
output: html_document
---

```{r , echo = FALSE, message = FALSE, warning = FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE)

                    
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(ggpubr)
library(plotly)
library(data.table)
library(scales)
library(stringr)      
library(formattable)
library(tidyr)
library(knitr)
```


## Fire Detections and Land Type in Bushfire Season


According to the  information provided by the department of agriculture of Australian, in the figure XXXX below can be seen the number of the fire detections by year. The number of cases registered by the season 2019/2020 were 103.627. The extent of land affected by the bushfires will be detailed i the next part of the report. something interesting to remark it that even though the season 2019/2020 seemed very hard for the country, in reality this number of cases is not compared with the number of observation for the same season in 2006/2007 and 2002/2003 that hold 3'327484 and 2'974.094 cases respectively in Victoria.


```{r fire, warning=FALSE, echo=FALSE, eval=TRUE, message=FALSE}

fire_detect <- read_csv("data/Table_MODIS_fire_counts_2002_2019_Victoria_per_fire_year.csv")
country_area_state <- read_csv("data/country_area_state.csv")
melb_air <- read_csv("data/melb_air.csv")
fire_detect_nw <- read_csv("data/fire_detect_nw.csv")
fire_total_detects <- read_csv("data/fire_total_detects.csv")
perc_affected_state <- read_csv("data/perc_affected_state.csv")
ft2total <- read_csv("data/ft2total.csv")
ft3burnt <-  read_csv("data/ft3burnt.csv")
ft4perc  <- read_csv("data/ft4perc.csv")
  
```



```{r, message=FALSE}


fire_total_detects %>% 
  select(Years, n) %>% 
  arrange(desc(n)) %>% 
  rename("Total Counts" = n) %>% 
  kable(caption = "Total detections by year") %>%
  kable_styling(c("hover", 
                  "condensed",
                  position = "center", 
                  fixed_thead = TRUE, full_width = F)) 

```


```{r, message=FALSE, fig.width=15}




 ggplot(fire_total_detects, 
                          aes(x = Years, 
                              y = n)) +
  geom_col(fill= 'coral3') +
  coord_flip()+
  labs(caption = "Visualisation per number of fire observations by year", y = "Counts") +
  geom_text(aes(label = n, size = 1, hjust= -0.5))+
  theme(legend.position = "none")+
  theme_bw()+
  scale_y_continuous(limits = c(0,3500000))


  

```



### Percentage of Affected Land by State


Taking in detail the number of the observations by state in the season 2019/2020, we can see that the states with major affectation of the forested land were Australian Capital Territory, Victoria and New south Wales with 92.78%, 92.02% and 90.15% respectively. See Figure XXXX. The territory with the least affectation was Northern Territory (0%), followed by South Australia with 43.68%.

```{r, message=FALSE}

perc_affected_state <- perc_affected_state  %>%
  select(Jurisdiction, 
         `Proportion of fire area that is forested (perc)`) %>% 
  mutate("Proportion of fire" = 100-`Proportion of fire area that is forested (perc)`) %>% 
  pivot_longer(names_to = "Burnt Area", values_to = "Percentage", cols = -Jurisdiction)
```


```{r, message=FALSE}
ggplot(data = perc_affected_state, aes(x = Jurisdiction,
                           y = Percentage, fill= `Burnt Area`)) +
    geom_bar(position="stack", stat="identity")+ 
    geom_text(aes(label = paste0(round(Percentage,2),"%")), position = position_stack(vjust = 0.5), size = 3)+
    scale_y_continuous(labels = function(x) paste0(x, "%"), 
                       breaks = seq(0, 100, 10))+
    coord_flip()+
    theme_bw()+
    theme(legend.position = "bottom")
   
  
 
```
### Percentage of Forested Land Affected in Victoria by Type


According to the classification of the land in Victoria, Multiple-use Public Forest got affected by 29%, whereas the Nature Conservation Reserve had 15% of burnt land. similarly the Unresolved tenure land lost 13% of it's extent by the fires. In the case of private land, around 6% was consumed by fires. 


```{r, message=FALSE}


ft4perc <- ft4perc  %>% 
  select(...1,Vic.) %>% 
  rename("Type of Forest" = ...1, "Burnt Land" = Vic.) %>% 
  filter(`Type of Forest` %in% 
           c("Leasehold forest", 
             "Multiple-use public forest", 
             "Nature conservation reserve", 
             "Other Crown land", 
             "Private forest", 
             "Unresolved tenure")) %>% 
  mutate("Safe Land" = 100-`Burnt Land`) %>% 
  pivot_longer(names_to = "Burnt Area Victoria", values_to = "Percentage", cols = -`Type of Forest`)

  ggplot(data = ft4perc, aes(x = `Type of Forest`,
                           y = Percentage, fill= `Burnt Area Victoria`)) +
    geom_bar(position= position_stack(reverse = T), stat="identity")+
    coord_flip()+
    theme(legend.position = "bottom")+
    theme_bw() +
    geom_text(aes(label = paste0(round(Percentage,2),"%")), position = position_stack(vjust = 0.5, reverse = T), size = 3)

```





## Melbourne Air Quality Index

The bushfires season had a huge negative impact in the air quality in Victoria, as an example we took data from the Environment Protection Authority in Australia which recorder the PM2.5 (Fine Particulate Matter 2.5) which is an air pollutant concern for the community's health, the higher the rate the worse impact for individuals. In the figure XXXX below can be seen the levels for the previous four years, with clearly a huge peak in January 2020.

```{r , warning=FALSE, message=FALSE}

melb_air2 <- melb_air %>%  select(date,pm25) %>% 
  mutate(date = as.Date(date, format = "%d/%m/%Y"))

melb_air2 %>%
  ggplot()+
  geom_line(aes(x = date, 
                y = pm25), 
            colour = "#FF6600")+
  theme_bw()+
  labs(x = "3 Year Historical Melbourne Air Index", 
       y = "Air Index Score")+
  scale_y_continuous(limits = c(0,280),
                     breaks = seq(0,280,50))


```


The figure below shows the classification of the air quality index, this source will give a clearer idea of the readings of the bushfire season and for previous levels. 


```{r fig.align='center', , message=FALSE}

knitr::include_graphics(here::here('images/polution_table.png'))

```

Finally, having a closer look to the most affected months from January to April, we cans see that on 15th January the levels recorded was 272, clearly very unhealthy, the population needed to be indoors even more for those with respiratory affections. Certainly the first two weeks were highly affected by the pollution and the fires, all this happened mainly in the first two weeks of the year, leaving highly affected the fauna and flora. 

```{r, , message=FALSE}



melb2020 <- melb_air2 %>% 
  filter(date >= "2019-12-01" & date <= "2020-03-30" ) %>% 
  

 ggplot()+
  geom_line(aes(x = date, 
                y = pm25), 
            colour = "#FF6600")+
  theme_bw()+
  labs(x = "Melbourne Air Index in 2020 (January to April)", 
       y = "Air Index Score")+
  scale_y_continuous(limits = c(0,300),
                     breaks = seq(0,300,20))

ggplotly(melb2020)

```


















