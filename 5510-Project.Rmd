---
title: "5510-Projecxt"
author: "T13_Wed_kable"
date: "5/17/2021"
output: html_document
---

```{r , echo = FALSE, message = FALSE, warning = FALSE, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, 
                      message=FALSE, 
                      warning=FALSE)

                    
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(ggpubr)
library(plotly)
library(data.table)
library(scales)
library(stringr)      
library(formattable)
library(tidyr)
library(sf)
library(readxl)
library(leaflet)
```



# Q7: How serious the threatened species affected by the Australian bushfire 2020, and whatâ€™s the distribution of them?

For analysing the influences on these threatened species, this question was divided into two parts: the threatened species distribution and summary the damages of bushfire. In addition, the spatial overlap and threatened status are regarded as the two focal variables on every category of species, so generally, we analysed the affects based on the two points.

In order to get the geographical coordinates of the species, we combined the data of the species of national environmental significance distributions which is GIS data with the data of species which affected by the bushfire. So here is a interactive map of the distribution for those species which occurred in areas affected by bushfire during 2019/20 season. 
```{r}
protected_species <- read_sf(here::here("data/snes_public_grids_08Aug2019_shapefile/snes_species_combined.shp")) %>%
  select(sci_name, comm_name,threatened, tax_class, tax_king, geometry)
```

```{r}
affected_species <- read_excel("data/protected-species-in-fire-affected-areas-20Jan.xlsx", sheet = 1, range= "C47:I378") %>%
  rename(sci_name = "Scientific Name\r\nwith links to  Species Profile and Threats (SPRAT) database for map and conservation documents",
         comm_name = "Common Name",
         affected_area = "Percentage of the species modelled likely and known distribution within fire affected areas",
         threatened_status = "EPBC Act listed Threatened Status")%>%
  select(sci_name, comm_name, affected_area, threatened_status)

# join affected_species with species
bushfire_species <- affected_species %>%
  left_join(protected_species, by = c("sci_name"))
```

```{r}
distribution_species <- bushfire_species%>%
  mutate(centroid = map(geometry, ~setNames(st_centroid(.x), c("x", "y")))) %>%
   unnest_wider(centroid)
```

```{r}
color <- colorFactor("Paired", distribution_species$tax_class)
leaflet(data = distribution_species)%>%
  addTiles()%>%
  fitBounds(130, -40, 150,-10)%>%
  addCircles(~x, ~y,
             popup = ~(sci_name),
             color = ~color(tax_class))%>%
  addLegend("bottomright", pal = color, values = ~tax_class, 
            title = NULL, opacity = 0.6)
  
```

The colour of the circle represents the species class, so it can be seen that those species who lived in the Southeastern of Australia, suffered the worst damage apparently, in addition, the plant belongs to Magnoliopsida class had the widest range of damage especially, with the class of Liliopsida followed behind.

The following summary of the results are indicative only, it's just a brief analysis of potential impacts of the bushfire on the species.
```{r}
# summary of the affected species
overlap_summary <- read_excel("data/protected-species-in-fire-affected-areas-20Jan.xlsx", sheet = 2, range = "B13:J17")%>%
  rename(Spatial_overlap = "Spatial Overlap")%>%
  pivot_longer(cols = Bird: Spider,
               names_to = "Species",
               values_to = "Count_overlap")

ggplot(overlap_summary,
       aes(Spatial_overlap, Count_overlap,
           fill = Species))+
  geom_col(position = "identity",
            alpha = 0.8)+
  scale_fill_brewer(palette = "OrRd")+
  xlab("Spatial overlap")+
  ylab("count")+
  ggtitle("The summary of the affects on the spatial overlap")+
  theme_bw()
```

According to the plot, it illustrates that more than 80% contained or known distribution had been damaged within the fire extent, besides, the Plant plays a role on the destruction to a varying degree, about 49 listed threatened species have been destroyed. However, most of listed species had more than 10% but less than 30% of the habitats damaged.

```{r}
category_spatial_summary <- read_excel("data/protected-species-in-fire-affected-areas-20Jan.xlsx", sheet = 2, range = "B4:F8")%>%
  pivot_longer(cols = `Critically Endangered`: `Listed Migratory only`,
               names_to = "threatened condition",
               values_to = "total_Count")

ggplot(category_spatial_summary,
       aes(`Spatial Overlap`, total_Count,
           fill = `threatened condition`))+
  geom_col(position = "fill",
            alpha = 0.8)+
  scale_fill_brewer(palette = "OrRd")+
  xlab("Spatial overlap")+
  ylab("Count")+
  ggtitle("The summary of the affects on the spacial overlap by the threantened status")+
  theme_bw()
```

So basically, it's the vulnerable and endangered species which suffered the most from the bushfire, there are more 10% but less than 30% habitats area had been destroyed for the most of the vulnerable species, about 80 species of them affected, besides, 10% to 30% area of habitats disappeared for 43 listed endangered species as well.

# Conclusion

To sum up, for most of the listed threatened species, there are more than 10% but less than 30% area has been destroyed, besides, the plants suffered the most serious destruction, with 107 plant species affected. The mammal frog and bird species had similar extent in the destruction.

But actually, many species not currently listed under national environmental law will have had much of their range affected by the fires, and in some cases, that impact may mean that these species have become threatened. The Department will be considering assessments of these species in the near future I think, besides, our knowledge about species distributions, fire severity, other threats, and impact on plants and animals is incomplete, that requires us to update the information further.