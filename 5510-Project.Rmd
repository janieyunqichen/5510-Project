---
title: "5510-Projecxt"
author: "T13_Wed_kable"
date: "5/17/2021"
output: 
  html_document: 
    fig_height: 8
    fig_caption: yes
    number_sections: yes
    toc: yes
---

```{r , echo = FALSE, message = FALSE, warning = FALSE, include=FALSE, eval = TRUE}
knitr::opts_chunk$set(echo = TRUE, 
                      message=FALSE, 
                      warning=FALSE)

                    
library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(ggplot2)
library(ggpubr)
library(plotly)
library(data.table)
library(scales)
library(stringr)      
library(formattable)
library(tidyr)
library(lubridate)
library(ggthemes)
```


## How long did it take on average for the CFA brigade to respond to incidents in their own areas for hazard class 2 in Q4 2018/19 and Q4 2019/20? Also, this will be analyzed against the standard time (given in the data for each of the hazard classes). (CFA Emergency Response Time)


### Introduction 

There are three critical components of CFA delivery services:
Response time: This is measured from when the brigade is alerted to an event to when the brigade arrives at the scene.

Brigade area: Each brigade has a defined brigade area, which specifies the operational footprint of the brigade.

Hazard classes: Hazard class defines the type of risk for a given area. Each brigade area may contain multiple hazard classes. However, each hazard class has a predefined service delivery standards. 

In the data we have two variables that record the amount of time it CFA brigade to respond to incidents in specified areas: 

 * The time in which 90% of emergency incidents were responded to by any brigade; and, 
 
 * The time in which 90% of emergency incidents were responded to by the brigade within their own Brigade Area
 
The variable of interest for us is : The time in which 90% of emergency incidents were responded to by the brigade within their own Brigade Area. The reason is because we want to find out the mean time in which CFA brigade responded to incidents in their own brigade areas. 

For this purpose, I did bit of data wrangling:

 - renamed variables such that now we have a `TimeReponse` variable, and `TimeReponse_within`variable. 
 
 - mutate Number of incidents into a numeric vector. 
 
 - Changed the character variables to time using the contributed library chron.
 
 
 
For this specific question, we are going to analyze the data for ***Hazard Class 2*** that covers significant urban areas and is primarily residential including commercial centres, clusters of industrial and/or high density community services e.g. schools, correctional facilities, hospitals. 

CFA has service delivery standards, which specify a response time target for a brigade to attend an emergency incident. The service delivery standard (response time) for Hazard Class 2 is **8 minutes**. Hence the analysis will be carried against this standard response time.


```{r}
data_20 <- read.csv("~/5510_group_project/data/dat_q4_2020.csv")%>%
  rename(CFA_district = CFA.District)%>%
  rename(CFA_Brigade_Area = CFA.Brigade.Area)%>%
  rename(Number_of_incidents = `Number.of.emergency.incidents.within.the.Brigade.Area.for.the.reporting.period.for.Hazard.Class.2`)%>%
  rename(TimeResponse = `The.time.in.which.90..of.emergency.incidents.were.responded.to.by.any.brigade`)%>%
  rename(TimeResponse_within = `The.time.in.which.90..of.emergency.incidents.were.responded.to.by.the.brigade.within.their.own.Brigade.Area`)%>%
  mutate(`TimeResponse_within`= paste0("00:",`TimeResponse_within`))%>%
  mutate(TimeResponse = paste0("00:",TimeResponse))%>%
  mutate(Number_of_incidents = as.numeric(Number_of_incidents))

data_20


```

```{r}
library(chron)

data_20$TimeResponse_within <- chron(times= data_20$TimeResponse_within)


data_20
```

```{r}
data_20$TimeResponse <- chron(times=data_20$TimeResponse)

data_20
```
### Context


The most recent data from April to June 2020 showed CFA brigades responded to 9,120 incidents, of which 4,893 required an emergency response.

In 87 per cent of incidents that required emergency response, the community received a fire service within the standard response time, which was broadly consistent with previous quarters.[CFA News](https://news.cfa.vic.gov.au/-/cfa-release-latest-response-data)

Let's visualize the data first.

```{r}
ggplot(data_20) +
  geom_point(data = data_20,
aes(x = TimeResponse_within,
y = CFA_Brigade_Area),
color = "red",
alpha = 0.6)+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), axis.title.x = element_text(vjust=-1.8))+
  labs(x = "Time Response in minutes",
y = "Brigade Areas")
   

 

```


```{r}
data_20 %>%
  select(TimeResponse_within)%>%
  summary(data_20$TimeResponse_within)%>%
  kable() %>%
kable_styling(bootstrap_options = c("striped","hover"))
```
The mean time that it took CFA brigades to respond to incidents in their own CFA brigade areas is `r mean(data_20$TimeResponse_within)`. This is very close to the target response time for brigades, which is eight minutes. 



```{r}
data20_avgRT <- function(TimeResponse_within){
  
  m = sum(TimeResponse_within)/length(TimeResponse_within)
  return(m)
}
data20_avgRT(data_20$TimeResponse_within)
  

```
For the year 2018/19, we have used the data belonging to the year 2018/19, which was acquired from the [CFA official site](https://discover.data.vic.gov.au/organization/country-fire-authority).

The most recent data set from July to September 2019 showed CFA brigades responding to 9,830 incidents, of which 5,013 required an emergency response.

In 87 per cent of emergencies, the community received a fire service within the standard response time, which was broadly consistent with previous quarters.[CFA News](https://news.cfa.vic.gov.au/-/cfa-releases-latest-response-data)

For this part of the question, I repeated the same data cleaning steps as mentioned above.

```{r}
data_19 <- read.csv("~/5510_group_project/data/dat_q4_2018_19.csv")%>%
  rename(CFA_district = CFA.District)%>%
  rename(CFA_Brigade_Area = CFA.Brigade.Area)%>%
  rename(Number_of_incidents = `Number.of.emergency.incidents.within.the.Brigade.Area.for.the.reporting.period.for.Hazard.Class.2`)%>%
  rename(TimeResponse = `The.time.in.which.90..of.emergency.incidents.were.responded.to.by.any.brigade`)%>%
  rename(TimeResponse_within = `The.time.in.which.90..of.emergency.incidents.were.responded.to.by.the.brigade.within.their.own.Brigade.Area`)%>%
  filter(TimeResponse_within != "NULL")%>%
  mutate(`TimeResponse_within`= paste0("00:",`TimeResponse_within`))%>%
  mutate(TimeResponse = paste0("00:",TimeResponse))%>%
  mutate(Number_of_incidents = as.numeric(Number_of_incidents))
  

data_19  
```
```{r}
library(chron)

data_19$TimeResponse_within <- chron(times= data_19$TimeResponse_within)



data_19
```

```{r}

data_19$TimeResponse <- chron(times=data_19$TimeResponse)

data_19
```
Let's visualize the data for the year 2018/19.



```{r}
ggplot(data_19) +
  geom_point(data = data_19,
aes(x = TimeResponse_within,
y = CFA_Brigade_Area),
color = "red",
alpha = 0.6)+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), axis.title.x = element_text(vjust=-1.8))+
  theme(axis.text.y =  element_text(angle = , vjust = 1, hjust=1), axis.title.y =  element_text(vjust=-1.8))+
labs(x = "Time Response",
y = "Brigade Areas")

```



```{r}
data_19%>%
  select(TimeResponse_within)%>%
  summary(data_19$TimeResponse_within)%>%
  kable() %>%
kable_styling(bootstrap_options = c("striped","hover"))
```
Using the summary function, we can see that the mean time taken by the CFA brigades to respond to the incidents in their own areas was `r mean(data_19$TimeResponse_within)`. This is agian very close to the target standard which was eight minutes.


```{r}
data19_avgRT <- function(TimeResponse_within){
  
  m = sum(TimeResponse_within, na.rm = TRUE)/length(TimeResponse_within)
  return(m)
}
data19_avgRT(data_19$TimeResponse_within) 

```

### Analysis

Keeping it brief, we can state that CFA brigades' performance against standard time of eight minutes for the hazard class 2 was achieved successfully, since we see a little variation in terms of amount of time taken by the CFA. 

## Which of the CFA brigade areas have had the highest number of incidents across Hazard classes for the reported period (2019/20) (four quarters). (CFA Emergency Response Time)

### Introduction

In this question, we have one variable that records the number of incidents across all hazard classes for all the specified districts. There are three predefined hazard classes: 2, 3 and 4. 
 
 * Hazard class 2 (Medium Urban): This includes significant urban areas which are primarily residential including commercial centres, clusters of industrial and/or high density community services e.g. schools, correctional facilities, hospitals. (8 minutes SDS). 
 
 * Hazard Class 3 (Low Urban): This includes all urban areas that are not included in Hazard Class 2 and includes predominantly residential occupancies and small industries. (10 minutes SDS). 
 
 * Hazard Class 4 (Rural): This includes primarily the natural surroundings in terms of bush and grassland, but also involves isolated dwellings and structures within those areas.

The variable of interest for us is : Number_Incidents_total.

For this purpose, I did bit of data wrangling:

 - renamed variables such that now we have a `CFA_Brigade_Area` variable, and `Number_Incidents_total`variable in each data set. (I had four datasets for Quarters 1, 2, 3,and 4)
 
 - mutate Number of incidents into a numeric vector. 
 
 - Join data using bind_rows

### Context
In this question we are concerned with district that has had the highest number of incidents across all hazard classes in the year 2019/20.

Let's first visualize data from each data set for the quarters 1, 2, 3 and 4 for the year 2019/20.

```{r}
dat_Q1_2020 <- read_csv("~/5510_group_project/data/dat_Q1_2020.csv") %>%
  rename(Number_Incidents_total =`Number of incidents within the Brigade Area for the reporting period across all Hazard Classes`)%>%
  rename(CFA_Brigade_Area = `CFA Brigade Area`)

dat_Q1_2020
```


```{r}
ggplot(dat_Q1_2020, aes( x = Number_Incidents_total, 
                         y = CFA_Brigade_Area)) + 
geom_point() +
  theme_light() + 
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), axis.title.x = element_text(vjust=-1.8))+
  theme(axis.text.y =  element_text(angle = , vjust = 0.5, hjust=1), axis.title.y =  element_text(vjust=-1.8))+
  
  xlab("Incidents") +  
 ylab("Districts") +  
  ggtitle("Number of incidents") 
```
The above plot shows us the number of incidents for the first quarter 2019/20. On the x-axis we have number of incidents and the y-axis we can see the names of districts.


```{r}
dat_Q2_2020 <- read_csv("~/5510_group_project/data/dat_Q2_2020.csv")%>%
  rename(Number_Incidents_total = `Number of incidents within the Brigade Area for the reporting period across all Hazard Classes`)%>%
  rename(CFA_Brigade_Area = `CFA Brigade Area`)

dat_Q2_2020
```


```{r, eval = TRUE}
 ggplot(dat_Q2_2020, aes(x = Number_Incidents_total ,    
                            y = CFA_Brigade_Area,
                            colour = factor(Number_Incidents_total)))+
                             
  geom_point() +  
  theme_light() +
  theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1), axis.title.x = element_text(vjust=-1.8))+
  theme(axis.text.y =  element_text(angle = , vjust = 1, hjust=1), axis.title.y =  element_text(vjust=-1.8))+
  ggtitle("Number of incidents")

```

Similiar to the plot above, this plot shows us the number of incidents for the second quarter 2019/20. On the x-axis we have number of incidents and the y-axis we can see the names of districts.






```{r}
dat_Q3_2020 <- read_csv("~/5510_group_project/data/dat_Q3_2020.csv") %>%
  rename(Number_Incidents_total = `Number of incidents within the Brigade Area for the reporting period across all Hazard Classes`)%>%
  rename(CFA_Brigade_Area = `CFA Brigade Area`)
  

dat_Q3_2020
```

```{r}
 ggplot(dat_Q3_2020) +
geom_point(aes(x = Number_Incidents_total,
y = CFA_Brigade_Area,
colour = factor(Number_Incidents_total)))  +
  theme_classic()
```


The above plot shows us the number of incidents for the third quarter 2019/20. On the x-axis we have number of incidents and the y-axis we can see the names of districts.


```{r}
dat_Q4_2020 <- read_csv("~/5510_group_project/data/dat_2020Q4.csv")%>%
  select(`CFA District`, `CFA Brigade Area`, `Number of incidents within the Brigade Area for the reporting period across all Hazard Classes`)%>%
  rename(Number_Incidents_total = `Number of incidents within the Brigade Area for the reporting period across all Hazard Classes`)%>%
    rename(CFA_Brigade_Area = `CFA Brigade Area`)
  
dat_Q4_2020
```

```{r}
ggplot(dat_Q4_2020) +
geom_point(aes(x = Number_Incidents_total,
y = CFA_Brigade_Area,
colour = factor(Number_Incidents_total))) +
  theme_igray()

```

The above plot shows us the number of incidents for the fourth quarter 2019/20. On the x-axis we have number of incidents and the y-axis we can see the names of districts.


```{r}
binding_data <- bind_rows(dat_Q1_2020,dat_Q2_2020,dat_Q3_2020,dat_Q4_2020)

binding_data
```

### Analysis

Using the summary function we can see the maximum number of incidents across all hazard classes for specified districts for the given time frame. Data used here is the merged data of the four data sets, using bind_rows function.

```{r}
DataQ1_4 <-  read_csv("~/5510_group_project/data/Question_3_dat_2.csv")%>%
  rename(Num_incdents1=`Number of incidents within the Brigade Area for the reporting period across all Hazard Classes Q1`)%>%
  rename(Num_incdents2=`Number of incidents within the Brigade Area for the reporting period across all Hazard Classes Q2`)%>%
  rename(Num_incdents3=`Number of incidents within the Brigade Area for the reporting period across all Hazard Classes Q3`)%>%
  rename(Num_incdents4=`Number of incidents within the Brigade Area for the reporting period across all Hazard Classes Q4`)

```



```{r}  
DataQ1 <- DataQ1_4 %>% 
  select(Num_incdents1,
         Num_incdents2,
         Num_incdents3,
         Num_incdents4)%>%
  summary()%>%
  kable(caption = "Summary of the incidents.") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
  
DataQ1
  
```
In the above table, we can see the summary for number of incidents in each quarter; we see that the highest number of incidents was recorded as `r max(DataQ1_4$Num_incdents2)` in the second quarter. 

The data used here is the merged data that contains information on all four quarters. For the next steps, we will use the binding_data from above. 


```{r}
 Highest_NumberIncidents <- binding_data%>%
  select(Number_Incidents_total)%>%
summary()%>%
  kable(caption = "This is the summary of number of incidents across all hazard classes") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))

Highest_NumberIncidents
```
We can see that highest number of incidents are `r max(binding_data$Number_Incidents_total)`, so now using the filter function. let's see which district has `r max(binding_data$Number_Incidents_total)` incidents. 



```{r}
binding_data%>%
  select(-X1,
         -`CFA District`)%>%
  filter(Number_Incidents_total == "374" )%>%
  kable(caption = "Dandenong district has the highest number of incidents across all hazard classes in all of the four quarters.") %>%
  kable_styling(bootstrap_options = c("striped", "hover"))
```
From the table we can see that Dandenong has had the highest number of incidents.

## Conclusion

As per the analysis for question on the performance of the brigade, it is safe to say that CFA brigades performed well against the standard delivery service time of eight minutes for the hazard class two incidents. And as per the analysis for the question on the number of incidents, we can see that Dandenong appears to be the area that had highest number of incidents across all hazard classes. 


